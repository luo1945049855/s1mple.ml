<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>S1mple</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="大口吃肉，大碗喝酒">
<meta property="og:type" content="website">
<meta property="og:title" content="S1mple">
<meta property="og:url" content="https://s1mple.ml/page/2/index.html">
<meta property="og:site_name" content="S1mple">
<meta property="og:description" content="大口吃肉，大碗喝酒">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="dayo">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="S1mple" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">S1mple</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://s1mple.ml"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-windows/wtl-thunk" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/09/windows/wtl-thunk/" class="article-date">
  <time datetime="2020-09-08T16:00:00.000Z" itemprop="datePublished">2020-09-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Windows/">Windows</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/09/windows/wtl-thunk/">WTL Thunk</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Thunk是一段机器码，主要有两个功能：</p>
<ol>
<li>改变调用栈;</li>
<li>跳转到目标程序；</li>
</ol>
<p>WTL中使用Thunk技术将GWLP_WNDPROC初始回调函数(一般为”StartWindowProc”)替换为用户期望回调函数（一般为”WindowProc”)。<br>初次接触时有几个问题可能费解：</p>
<ol>
<li>WTL在何处RegisterClass</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T::GetWndClassInfo().Register()</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>WTL在何处存放this指针供StartWindowProc获取</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_AtlWinModule.AddCreateWndData(&amp;<span class="keyword">this</span>-&gt;m_thunk.cd, <span class="keyword">this</span>);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Thunk细节</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">stdcallthunk</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	DWORD   m_mov;          <span class="comment">// mov dword ptr [esp+0x4], pThis (esp+0x4 is hWnd)</span></span><br><span class="line">	DWORD   m_this;         <span class="comment">//</span></span><br><span class="line">	BYTE    m_jmp;          <span class="comment">// jmp WndProc</span></span><br><span class="line">	DWORD   m_relproc;      <span class="comment">// relative jmp</span></span><br><span class="line">	<span class="function">BOOL <span class="title">Init</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">		_In_ DWORD_PTR proc,</span></span></span><br><span class="line"><span class="function"><span class="params">		_In_opt_ <span class="keyword">void</span>* pThis)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		m_mov = <span class="number">0x042444C7</span>;  <span class="comment">//C7 44 24 0C</span></span><br><span class="line">		m_this = PtrToUlong(pThis);</span><br><span class="line">		m_jmp = <span class="number">0xe9</span>;</span><br><span class="line">		m_relproc = DWORD((INT_PTR)proc - ((INT_PTR)<span class="keyword">this</span>+<span class="keyword">sizeof</span>(_stdcallthunk)));</span><br><span class="line">		<span class="comment">// write block from data cache and</span></span><br><span class="line">		<span class="comment">//  flush from instruction cache</span></span><br><span class="line">		FlushInstructionCache(GetCurrentProcess(), <span class="keyword">this</span>, <span class="keyword">sizeof</span>(_stdcallthunk));</span><br><span class="line">		<span class="keyword">return</span> TRUE;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//some thunks will dynamically allocate the memory for the code</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span>* <span class="title">GetCodeAddress</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	_Ret_maybenull_ _Post_writable_byte_size_(<span class="keyword">sizeof</span>(_stdcallthunk)) <span class="function"><span class="keyword">void</span>* <span class="keyword">operator</span> <span class="title">new</span><span class="params">(_In_ <span class="keyword">size_t</span>)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> __AllocStdCallThunk();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="keyword">operator</span> <span class="title">delete</span><span class="params">(_In_opt_ <span class="keyword">void</span>* pThunk)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        __FreeStdCallThunk(pThunk);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在 Init() 函数中这组汇编指令被初始化为下面的指令：</p>
<p>mov dword ptr [esp+0x4], pThis<br>jmp (int)proc - ((int)this+sizeof(_WndProcThunk))</p>
<p>它完成的功能是，用窗口类的指针 pThis 代替窗口句柄 hWnd （ esp+0x4 中放的就是 hWnd ），然后跳转到传入的 proc 函数处（ (int)proc - ((int)this+sizeof(_WndProcThunk)) 是 proc 与 thunk 之间的距离）。</p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/chenyujing1234/article/details/7443084">WTL中 Thunk技术本质</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/tttyd/article/details/4562233">ATL Thunk机制学习</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://s1mple.ml/2020/09/09/windows/wtl-thunk/" data-id="ckev6e5hy000aqgvv0kz37bx2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-misc/MT-MTd-MD-MDd" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/09/misc/MT-MTd-MD-MDd/" class="article-date">
  <time datetime="2020-09-08T16:00:00.000Z" itemprop="datePublished">2020-09-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Misc/">Misc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/09/misc/MT-MTd-MD-MDd/">MT-MTd-MD-MDd</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="MT和-MTd"><a href="#MT和-MTd" class="headerlink" title="/MT和/MTd"></a>/MT和/MTd</h2><p> /MT和/MTd表示采用多线程CRT库的静态lib版本。该选项会在编译时将运行时库以静态lib的形式完全嵌入。该选项生成的可执行文件运行时不需要运行时库dll的参加，会获得轻微的性能提升，但最终生成的二进制代码因链入庞大的运行时库实现而变得非常臃肿。当某项目以静态链接库的形式嵌入到多个项目，则可能造成运行时库的内存管理有多份，最终将导致致命的“Invalid Address specified to RtlValidateHeap”问题。另外托管C++和CLI中不再支持/MT和/MTd选项。</p>
<h2 id="MD和-MDd"><a href="#MD和-MDd" class="headerlink" title="/MD和/MDd"></a>/MD和/MDd</h2><p>/MD和/MDd表示采用多线程CRT库的动态dll版本，会使应用程序使用运行时库特定版本的多线程DLL。链接时将按照传统VC链接dll的方式将运行时库MSVCRxx.DLL的导入库MSVCRT.lib链接，在运行时要求安装了相应版本的VC运行时库可再发行组件包（当然把这些运行时库dll放在应用程序目录下也是可以的）。 因/MD和/MDd方式不会将运行时库链接到可执行文件内部，可有效减少可执行文件尺寸。当多项目以MD方式运作时，其内部会采用同一个堆，内存管理将被简化，跨模块内存管理问题也能得到缓解。</p>
<h2 id="ML和-MLd"><a href="#ML和-MLd" class="headerlink" title="/ML和/MLd"></a>/ML和/MLd</h2><p>单线程运行时库选项/ML和/MLd在VS2003以后就被废了。</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>/MD和/MDd将是潮流所趋，/ML和/MLd方式请及时放弃，/MT和/MTd在非必要时最好也不要采用了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://s1mple.ml/2020/09/09/misc/MT-MTd-MD-MDd/" data-id="ckev6y915000018vv55pchven" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-misc/curve" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/09/misc/curve/" class="article-date">
  <time datetime="2020-09-08T16:00:00.000Z" itemprop="datePublished">2020-09-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Misc/">Misc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/09/misc/curve/">Curve</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Bezier-Curve"><a href="#Bezier-Curve" class="headerlink" title="Bezier Curve"></a>Bezier Curve</h2><p>贝塞尔曲线通过两个<code>端点</code>和两个<code>控制点</code>指定。<br>曲线不会通过控制点，但是控制点会像磁铁一样将曲线拉向控制点的方向，并影响曲线的弯曲。<br>如下图所示：</p>
<p><img src="/images/bezier_spline.png" alt="bezier_splines"></p>
<p>注意：<br>曲线从端点p1开始，向控制点c1移动。曲线在端点p1处的<code>切线</code>是p1和c1的连线。<br>曲线在端点p2处的切线是p2和c2的连线。</p>
<h2 id="给定一系列点，画曲线"><a href="#给定一系列点，画曲线" class="headerlink" title="给定一系列点，画曲线"></a>给定一系列点，画曲线</h2><p>此处找到的方式有：</p>
<ul>
<li><p>Krita（基于Qt的画图工具）基于Bezier曲线的实现。</p>
</li>
<li><p>JScurve求平均值方式，可以使点平滑。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/burningmime/curves">burningmime</a>基于<code>Philip J. Schneider&#39;s least-squares method</code>实现的方案。此方案效果较好，但是有出错情况而且性能较差。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.codeproject.com/Articles/31859/Draw-a-Smooth-Curve-through-a-Set-of-2D-Points-wit">Draw a Smooth Curve through a Set of 2D Points with Bezier Primitives</a>。</p>
</li>
</ul>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/gdiplus/-gdiplus-bezier-splines-about">Bezier Splines</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/30791706/gdi-curve-overflowing/49693235">GDI+ curve “overflowing”</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://s1mple.ml/2020/09/09/misc/curve/" data-id="ckev6y91c000118vv76u6hacu" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-misc/memory-type" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/09/misc/memory-type/" class="article-date">
  <time datetime="2020-09-08T16:00:00.000Z" itemprop="datePublished">2020-09-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Misc/">Misc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/09/misc/memory-type/">Memory Type</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/1984186/what-is-private-bytes-virtual-bytes-working-set">原地址：What is private bytes, virtual bytes, working set?</a></p>
<ul>
<li><p>Private Bytes：指可执行文件申请的，不一定是实际使用的。private代表它不包括memory-mapped files（例如：共享dll）占用的内存。但是它是包括dll中的函数所分配内存的，所以Private Bytes大小的变化可能由可执行文件和共享dll引起。Private Bytes不止是物理内存，还可能page to disk或者page list(i.e. no longer in use, but not paged yet either)</p>
</li>
<li><p>Working Set：代表进程占用的全部物理内存（RAM），但是不同于Private Bytes，它包括memory-mapped files（例如：共享dll）和其他资源，与Private Bytes相比，更加不能代表一个可执行文件使用的内存。任务管理器中的“内存使用”就是该值，最近几年造成了很多的误解。Working Set代表占用RAM中的内存大小，所以访问其中内存地址时不会有page fault。注意：虽然page list仍然在内存中，当你最小化窗口时，“内存使用”可能会突然减小。</p>
</li>
<li><p>Virtual Bytes：代表整个进程占用的全部虚拟内存空间，包括memory-mapped files、page list以及page to disk。当系统中存在大量进程时，所有进程的Virtual Bytes的和会比机器的物理内存大出很多。</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://s1mple.ml/2020/09/09/misc/memory-type/" data-id="ckev6y91d000218vv5q6i9qka" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-network/tcp-establish-terminate" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/09/network/tcp-establish-terminate/" class="article-date">
  <time datetime="2020-09-08T16:00:00.000Z" itemprop="datePublished">2020-09-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Network/">Network</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/09/network/tcp-establish-terminate/">TCP Connection Establish and Terminate</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Connection-establishment"><a href="#Connection-establishment" class="headerlink" title="Connection establishment"></a>Connection establishment</h2><p>To establish a connection, TCP uses a three-way handshake. Before a client attempts to connect with a server, the server must first bind to and listen at a port to open it up for connections: this is called a passive open. Once the passive open is established, a client may initiate an active open. To establish a connection, the three-way (or 3-step) handshake occurs:</p>
<ol>
<li>SYN: The active open is performed by the client sending a SYN to the server. The client sets the segment’s sequence number to a random value A.</li>
<li>SYN-ACK: In response, the server replies with a SYN-ACK. The acknowledgment number is set to one more than the received sequence number (A + 1), and the sequence number that the server chooses for the packet is another random number, B.</li>
<li>ACK: Finally, the client sends an ACK back to the server. The sequence number is set to the received acknowledgement value i.e. A + 1, and the acknowledgement number is set to one more than the received sequence number i.e. B + 1.</li>
</ol>
<p>At this point, both the client and server have received an acknowledgment of the connection.</p>
<ul>
<li>The steps 1, 2 establish the connection parameter (sequence number) for one direction and it is acknowledged.</li>
<li>The steps 2, 3 establish the connection parameter (sequence number) for the other direction and it is acknowledged. With these, a full-duplex communication is established.</li>
</ul>
<h2 id="Connection-termination"><a href="#Connection-termination" class="headerlink" title="Connection termination"></a>Connection termination</h2><h3 id="four-way-handshake-termination"><a href="#four-way-handshake-termination" class="headerlink" title="four-way handshake termination"></a>four-way handshake termination</h3><p>The connection termination phase uses a four-way handshake, with <code>each side of the connection terminating independently</code>.</p>
<ol>
<li><p>FIN(host A): When an endpoint wishes to stop its half of the connection, it transmits a FIN packet.</p>
</li>
<li><p>ACK(host B): which the other end acknowledges with an ACK.</p>
</li>
<li><p>FIN(host B):</p>
</li>
<li><p>ACK(host A):</p>
</li>
</ol>
<p>Therefore, a typical tear-down requires <code>a pair of</code> FIN and ACK segments from each TCP endpoint.<br>After <code>both</code> FIN/ACK exchanges are concluded,<br>The side which sent the first FIN waits for a timeout before finally closing the connection,<br>during which time the local port is unavailable for new connections;<br>This prevents confusion due to delayed packets being delivered during subsequent connections.</p>
<p>A connection can be “half-open”, in which case one side has terminated its end, but the other has not.<br>The side that has terminated can no longer send any data into the connection, but the other side can.<br>The terminating side should continue reading the data until the other side terminates as well.</p>
<h3 id="three-way-handshake-termination"><a href="#three-way-handshake-termination" class="headerlink" title="three-way handshake termination"></a>three-way handshake termination</h3><p>It is also possible to terminate the connection by a 3-way handshake,<br><code>This is perhaps the most common method</code>.</p>
<ol>
<li><p>FIN: when host A sends a FIN.</p>
</li>
<li><p>FIN &amp; ACK: host B replies with a <code>FIN &amp; ACK</code> (merely combines 2 steps into one).</p>
</li>
<li><p>ACK: host A replies with an ACK.</p>
</li>
</ol>
<p>It is possible for both hosts to send FINs simultaneously then both just have to ACK. This could possibly be considered a 2-way handshake since the FIN/ACK sequence is done in parallel for both directions.</p>
<p>Some host TCP stacks may implement a half-duplex close sequence, as Linux or HP-UX do.</p>
<p>If such a host actively closes a connection but still has not read all the incoming data<br>the stack already received from the link, this host sends a RST instead of a FIN<br>(Section 4.2.2.13 in RFC 1122).</p>
<p>This allows a TCP application to be sure the remote application has read all the data<br>the former sent—waiting the FIN from the remote side, when it actively closes the connection.</p>
<p>However, the remote TCP stack cannot distinguish between a <code>Connection Aborting RST</code><br>and this <code>Data Loss RST</code>.<br>Both cause the remote stack to throw away all the data it received, but that the application still didn’t read.</p>
<h2 id="Sequence-Number"><a href="#Sequence-Number" class="headerlink" title="Sequence Number"></a>Sequence Number</h2><ol>
<li><p>SYN: Step 1. Device A (Client) sends a TCP segment with <code>SYN = 1, ACK = 0</code>, <code>ISN (Initial Sequence Number) = 2000</code>.<br>The Active Open device (Device A) sends a segment with the SYN flag set to 1, ACK flag set to 0 and an Initial Sequence Number 2000 (For Example), which marks the beginning of the sequence numbers for data that device A will transmit.<br>SYN is short for SYNchronize. SYN flag announces an attempt to open a connection. The first byte transmitted to Device B will have the sequence number ISN+1.</p>
</li>
<li><p>SYN &amp; ACK: Step 2. Device B (Server) receives Device A’s TCP segment and returns a TCP segment with<br><code>SYN = 1, ACK = 1</code>, <code>ISN = 5000 (Device B’s Initial Sequence Number), Acknowledgment Number = 2001</code> (2000 + 1, the next sequence number Device B expecting from Device A).</p>
</li>
<li><p>ACK: Step 3. Device A sends a TCP segment to Device B that acknowledges receipt of Device B’s ISN, With flags set as <code>SYN = 0, ACK = 1</code>, <code>Sequence number = 2001, Acknowledgment number = 5001</code> (5000 + 1, the next sequence number Device A expecting from Device B)</p>
</li>
</ol>
<p>This handshaking technique is referred to as the Three-way handshake or SYN, SYN-ACK, ACK.</p>
<p>After the three-way handshake, the connection is open and the participant computers start sending data using the sequence and acknowledge numbers.</p>
<p>You have learned what is TCP three way hand shake (3 way handshake), the three steps of a TCP three way handshake and how two TCP devices synchronize.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://s1mple.ml/2020/09/09/network/tcp-establish-terminate/" data-id="ckg1x80vo0000i4vv3vq91s49" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-misc/mutex_lock" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/09/misc/mutex_lock/" class="article-date">
  <time datetime="2020-09-08T16:00:00.000Z" itemprop="datePublished">2020-09-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Misc/">Misc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/09/misc/mutex_lock/">Mutex vs Lock</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="mutex"><a href="#mutex" class="headerlink" title="mutex"></a>mutex</h2><p>mutex提供exclusive一种lock</p>
<ol>
<li>lock、try_lock、unlock</li>
</ol>
<p>shared_mutex提供shared以及exclusive两种lock：</p>
<ol>
<li><code>lock_shared、try_lock_shared、unlock_shared</code></li>
<li><code>lock、try_lock、unlock</code></li>
</ol>
<h2 id="lock"><a href="#lock" class="headerlink" title="lock"></a>lock</h2><ul>
<li><code>unique_lock&lt;mutex&gt;</code>提供lock、try_lock、unlock接口，实为调用mutex/shared_mutex的exclusive接口。</li>
<li><code>shared_lock&lt;mutex&gt;</code>提供lock、try_lock、unlock接口，实为调用shared_mutex的shared接口。</li>
<li>unique_lock和shared_lock都是只能move不能copy的。</li>
<li>unique_lock和shared_lock可以配合shared_mutex实现read-write lock。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://s1mple.ml/2020/09/09/misc/mutex_lock/" data-id="ckev6y91f000418vv0qgucx1y" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-misc/shared_ptr" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/09/misc/shared_ptr/" class="article-date">
  <time datetime="2020-09-08T16:00:00.000Z" itemprop="datePublished">2020-09-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Misc/">Misc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/09/misc/shared_ptr/">Shared_Ptr</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">shared_ptr</span> &#123;</span></span><br><span class="line">    ......</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T * px;                         <span class="comment">//contained pointer</span></span><br><span class="line">    boost::detail::shared_count pn; <span class="comment">//reference counter</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">shared_count</span> &#123;</span></span><br><span class="line">    ......</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    sp_counted_base * pi_;      <span class="comment">//important</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sp_counted_base</span> &#123;</span></span><br><span class="line">    ......</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">//pointer shared count</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="keyword">atomic_int_least32_t</span> use_count_;   </span><br><span class="line">    <span class="comment">//self(sp_counted_bast *) shared count </span></span><br><span class="line">    <span class="built_in">std</span>::<span class="keyword">atomic_int_least32_t</span> weak_count_;  </span><br><span class="line"> &#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="enable-shared-from-this-作用"><a href="#enable-shared-from-this-作用" class="headerlink" title="enable_shared_from_this 作用"></a>enable_shared_from_this 作用</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">enable_shared_from_this</span> &#123;</span>&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// inherited from enable_shared_from_this</span></span><br><span class="line"><span class="keyword">template</span>&lt; <span class="class"><span class="keyword">class</span> <span class="title">X</span>, <span class="title">class</span> <span class="title">Y</span>, <span class="title">class</span> <span class="title">T</span> &gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> <span class="title">sp_enable_shared_from_this</span>(</span></span><br><span class="line"><span class="class">     <span class="title">boost</span>:</span>:<span class="built_in">shared_ptr</span>&lt;X&gt; <span class="keyword">const</span> * ppx, Y <span class="keyword">const</span> * py,</span><br><span class="line">     boost::enable_shared_from_this&lt; T &gt; <span class="keyword">const</span> * pe ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( pe != <span class="number">0</span> ) &#123;</span><br><span class="line">        pe-&gt;_internal_accept_owner( ppx, <span class="keyword">const_cast</span>&lt; Y* &gt;( py ) );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// not inherited from enable_shared_from_this</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">sp_enable_shared_from_this</span><span class="params">( ... )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://s1mple.ml/2020/09/09/misc/shared_ptr/" data-id="ckev6y91g000618vv7c8gekgj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-misc/runtime-errors" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/09/misc/runtime-errors/" class="article-date">
  <time datetime="2020-09-08T16:00:00.000Z" itemprop="datePublished">2020-09-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Misc/">Misc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/09/misc/runtime-errors/">Runtime Error</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Pure-Virtual-on-Call"><a href="#Pure-Virtual-on-Call" class="headerlink" title="Pure Virtual on Call"></a>Pure Virtual on Call</h2><ol>
<li>Reason</li>
</ol>
<p>They can result if you try to make a virtual function call from a constructor or destructor. Since you can’t make a virtual function call from a <code>constructor</code> or <code>destructor</code> (the derived class object hasn’t been constructed or has already been destroyed), it calls the base class version, which in the case of a pure virtual function, doesn’t exist.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://s1mple.ml/2020/09/09/misc/runtime-errors/" data-id="ckev6y91h000818vv8tqd52go" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-misc/std-classes-cross-dll-boundary" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/09/misc/std-classes-cross-dll-boundary/" class="article-date">
  <time datetime="2020-09-08T16:00:00.000Z" itemprop="datePublished">2020-09-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Misc/">Misc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/09/misc/std-classes-cross-dll-boundary/">Use std classes cross dll boundary</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Keep in mind one thing before you read further: My answer is coming from the point of view of writing portable code that can be used in applications made up of modules compiled under different compilers. This can include different versions or even different patch levels of the same compiler.</p>
<p>How can I use stl-classes in my dll-interface?</p>
<p>Answer: You often can’t1.</p>
<p>Reason: The STL is a code library, not a binary library like a DLL. It does not have a single ABI that is guaranteed to be the same wherever you might use it. Indeed, STL does stand for “Standard Template Library,” but a key operative word here besides Standard is Template.</p>
<p>The Standard defines the methods and data members each STL class is required to provide, and it defines what those methods are to do; but no more. In particular, the Standard doesn’t specify how compiler writers should implement the Standard-defined functionality. Compiler writers are free to provide a implementation of an STL class that adds member functions and member variables not listed in the Standard, so long as those members which are defined in the Standard are still there and do what the Standard says.</p>
<p>Maybe an example is in order. The basic_string class is defined in the Standard as having certain member functions &amp; variables. The actual definition is almost 4 pages in the Standard, but here’s just a snippet of it:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="built_in">std</span> &#123;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">charT</span>, <span class="title">class</span> <span class="title">traits</span> = <span class="title">char_traits</span>&lt;charT&gt;,</span></span><br><span class="line"><span class="class">         <span class="title">class</span> <span class="title">Allocator</span> = <span class="title">allocator</span>&lt;charT&gt; &gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">basic_string</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function">size_type <span class="title">size</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">  <span class="function">size_type <span class="title">length</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">  <span class="function">size_type <span class="title">max_size</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">resize</span><span class="params">(size_type n, charT c)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">resize</span><span class="params">(size_type n)</span></span>;</span><br><span class="line">  <span class="function">size_type <span class="title">capacity</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">reserve</span><span class="params">(size_type res_arg = <span class="number">0</span>)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">empty</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Consider the size() and length() member functions. There is nothing in the Standard that specified member variables for holding this information. Indeed, there are no member variables defined at all, not even to hold the string itself. So how is this implemented?</p>
<p>The answer is, many different ways. Some compilers might use a size_t member variable to hold the size and a char* to hold the string. Another one might use a pointer to some other data store which holds that data (this might be the case in a reference-counted implementation). In fact, different versions or even patch levels of the same compiler may change these implementation details. You can’t rely on them. So, MSVC 10’s implementation might look like this:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="built_in">std</span> &#123;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">charT</span>, <span class="title">class</span> <span class="title">traits</span> = <span class="title">char_traits</span>&lt;charT&gt;,</span></span><br><span class="line"><span class="class">         <span class="title">class</span> <span class="title">Allocator</span> = <span class="title">allocator</span>&lt;charT&gt; &gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">basic_string</span> &#123;</span></span><br><span class="line"><span class="keyword">char</span>* m_pTheString;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">basic_string::size</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">strlen</span>(m_pTheString;) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>…Whereas MSVC 10 with SP1 might look like this:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="built_in">std</span> &#123;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">charT</span>, <span class="title">class</span> <span class="title">traits</span> = <span class="title">char_traits</span>&lt;charT&gt;,</span></span><br><span class="line"><span class="class">         <span class="title">class</span> <span class="title">Allocator</span> = <span class="title">allocator</span>&lt;charT&gt; &gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">basic_string</span> &#123;</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt; m_TheString;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">basic_string::size</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> m_TheString.size(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>I’m not saying they do look like this, I’m saying they might. The point here is the actual implementation is platform-dependent, and you really have no way of knowing what it will be anywhere else.</p>
<p>Now say you use MSVC10 to write a DLL that exports this class:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyGizmo</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> name_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>What is the sizeof(MyGizmo)?</p>
<p>Assuming my proposed implementations above, under MSVC10 its going to be <code>sizeof(char*)</code>, but under SP1 it will be <code>sizeof(vector&lt;char&gt;)</code>. If you write an application in VC10 SP1 that uses the DLL, the size of the object will look different than it actually is. The binary interface is changed.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://s1mple.ml/2020/09/09/misc/std-classes-cross-dll-boundary/" data-id="ckev6y91i000a18vve63832en" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-misc/warnings" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/09/misc/warnings/" class="article-date">
  <time datetime="2020-09-08T16:00:00.000Z" itemprop="datePublished">2020-09-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Misc/">Misc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/09/misc/warnings/">Warnings</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="c4251"><a href="#c4251" class="headerlink" title="c4251"></a>c4251</h2><p>当导出类中包含未导出类的数据成员时出现，例如：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TemplateClass</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> --<span class="title">declspec</span>(<span class="title">dllexport</span>) <span class="title">ExportedClass</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    TemplateClass&lt;<span class="keyword">int</span>&gt; m_member;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>Pimpl(Pointer to implementation)模式</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://s1mple.ml/2020/09/09/misc/warnings/" data-id="ckev6y91j000c18vv16c08gpm" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CEF/">CEF</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Chromium/">Chromium</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/">Frontend</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Math/">Math</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Misc/">Misc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2000/01/">January 2000</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/10/10/network/tcp-ip-osi-model/">TCP/IP vs OSI Model</a>
          </li>
        
          <li>
            <a href="/2020/09/24/windows/batch/">Batch Script</a>
          </li>
        
          <li>
            <a href="/2020/09/17/math/matrix/">Matrix</a>
          </li>
        
          <li>
            <a href="/2020/09/16/windows/uniquely_identify_a_windows_machine/">Way to uniquely identify a windows machine</a>
          </li>
        
          <li>
            <a href="/2020/09/15/misc/soft_hyphen/">Soft Hyphen</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 dayo<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>